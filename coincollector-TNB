-- Coin Collector GUI Toggle Script
local Player = game.Players.LocalPlayer
local collecting = false
local connection

-- Create ScreenGui with proper persistence
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CoinCollectorGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

-- Create Main Frame (increased height to fit credit)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 200, 0, 140)  -- Increased from 120 to 140
MainFrame.Position = UDim2.new(0, 10, 0, 10)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
MainFrame.Parent = ScreenGui

-- Add corner rounding
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Add shadow effect
local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(80, 80, 80)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- Title Label
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Name = "TitleLabel"
TitleLabel.Size = UDim2.new(1, 0, 0, 30)
TitleLabel.Position = UDim2.new(0, 0, 0, 0)
TitleLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TitleLabel.BackgroundTransparency = 0
TitleLabel.Text = "(TNB) Coin Collector"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 16
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Parent = MainFrame

-- Corner for title
local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleLabel

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(1, -20, 0, 25)
StatusLabel.Position = UDim2.new(0, 10, 0, 40)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Status: OFF"
StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
StatusLabel.TextSize = 14
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = MainFrame

-- Toggle Button
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(1, -20, 0, 35)
ToggleButton.Position = UDim2.new(0, 10, 0, 70)  -- Moved up slightly
ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
ToggleButton.Text = "START COLLECTING"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 14
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Parent = MainFrame

-- Button corner rounding
local ButtonCorner = Instance.new("UICorner")
ButtonCorner.CornerRadius = UDim.new(0, 6)
ButtonCorner.Parent = ToggleButton

-- Credit Label
local CreditLabel = Instance.new("TextLabel")
CreditLabel.Name = "CreditLabel"
CreditLabel.Size = UDim2.new(1, -20, 0, 15)
CreditLabel.Position = UDim2.new(0, 10, 0, 110)  -- Positioned under toggle button
CreditLabel.BackgroundTransparency = 1
CreditLabel.Text = "Made by @wh0asked1"
CreditLabel.TextColor3 = Color3.fromRGB(150, 150, 200)
CreditLabel.TextSize = 10
CreditLabel.Font = Enum.Font.Gotham
CreditLabel.TextXAlignment = Enum.TextXAlignment.Center
CreditLabel.Parent = MainFrame

-- SIMPLE DRAGGING SYSTEM THAT ACTUALLY WORKS
local UserInputService = game:GetService("UserInputService")
local dragging = false
local dragStart = nil
local startPosition = nil

-- Function to start dragging
local function startDrag()
    dragging = true
    dragStart = UserInputService:GetMouseLocation()
    startPosition = MainFrame.Position
end

-- Function to stop dragging
local function stopDrag()
    dragging = false
    dragStart = nil
    startPosition = nil
end

-- Function to update drag position
local function updateDrag()
    if not dragging then return end
    
    local currentMouse = UserInputService:GetMouseLocation()
    local delta = Vector2.new(
        currentMouse.X - dragStart.X,
        currentMouse.Y - dragStart.Y
    )
    
    MainFrame.Position = UDim2.new(
        startPosition.X.Scale,
        startPosition.X.Offset + delta.X,
        startPosition.Y.Scale,
        startPosition.Y.Offset + delta.Y
    )
end

-- Connect mouse events to TitleLabel
TitleLabel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        startDrag()
        
        -- Disconnect when mouse button is released
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                stopDrag()
                connection:Disconnect()
            end
        end)
    end
end)

-- Connect touch events to TitleLabel
TitleLabel.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        startDrag()
        
        -- Disconnect when touch ends
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                stopDrag()
                connection:Disconnect()
            end
        end)
    end
end)

-- Update position while dragging
game:GetService("RunService").Heartbeat:Connect(function()
    if dragging then
        updateDrag()
    end
end)

-- Coin Collection Functions
local function collectCoins()
    if not collecting then return end
    
    local character = Player.Character
    if not character then return end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    for _, obj in pairs(workspace:GetDescendants()) do
        if not collecting then break end
        if obj.Name == "Coin" then
            local touch = obj:FindFirstChildOfClass("TouchTransmitter") or obj:FindFirstChild("TouchInterest")
            if touch then
                firetouchinterest(hrp, obj, 0)
                firetouchinterest(hrp, obj, 1)
            end
        end
    end
end

local function startCollecting()
    if connection then connection:Disconnect() end
    
    connection = game:GetService("RunService").Heartbeat:Connect(function()
        collectCoins()
    end)
end

local function stopCollecting()
    collecting = false
    if connection then
        connection:Disconnect()
        connection = nil
    end
end

-- Handle character respawns
Player.CharacterAdded:Connect(function()
    if collecting then
        wait(2)
        if not connection then
            startCollecting()
        end
    end
end)

-- Toggle function
local function toggleCoinCollect()
    collecting = not collecting
    
    if collecting then
        StatusLabel.Text = "Status: ON"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        ToggleButton.Text = "STOP COLLECTING"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(60, 200, 60)
        print("Coin collector: ON")
        startCollecting()
    else
        StatusLabel.Text = "Status: OFF"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        ToggleButton.Text = "START COLLECTING"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        print("Coin collector: OFF")
        stopCollecting()
    end
end

-- Connect toggle button
ToggleButton.MouseButton1Click:Connect(toggleCoinCollect)

-- Close button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 20, 0, 20)
CloseButton.Position = UDim2.new(1, -25, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 12
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleLabel

CloseButton.MouseButton1Click:Connect(function()
    stopCollecting()
    ScreenGui:Destroy()
end)

-- Add some smooth animations
ToggleButton.MouseEnter:Connect(function()
    game:GetService("TweenService"):Create(ToggleButton, TweenInfo.new(0.1), {BackgroundTransparency = 0.2}):Play()
end)

ToggleButton.MouseLeave:Connect(function()
    game:GetService("TweenService"):Create(ToggleButton, TweenInfo.new(0.1), {BackgroundTransparency = 0}):Play()
end)

print("Coin Collector GUI Loaded!")
print("Drag the title bar to move the window!")
print("GUI will stay visible when you die!")
